!function(e){var t={};function s(a){if(t[a])return t[a].exports;var i=t[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(a,i,function(t){return e[t]}.bind(null,i));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t,s){},function(e,t,s){"use strict";s.r(t);s(0);function a(e,t){let s=[];for(let e=8;e<t*(t-1);e+=t)s.push(e);let a=[];for(let e=7;e<t*(t-1);e+=t)a.push(e);return 0===e?"top-left":e<t-1?"top":e===t-1?"top-right":-1!==s.indexOf(e)?"left":-1!==a.indexOf(e)?"right":e===t*(t-1)?"bottom-left":e===t*t-1?"bottom-right":e>t*(t-1)?"bottom":"center"}class n{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",e=>this.onNewGameClick(e)),this.saveGameEl.addEventListener("click",e=>this.onSaveGameClick(e)),this.loadGameEl.addEventListener("click",e=>this.onLoadGameClick(e)),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const t=document.createElement("div");t.classList.add("cell","map-tile",`map-tile-${a(e,this.boardSize)}`),t.addEventListener("mouseenter",e=>this.onCellEnter(e)),t.addEventListener("mouseleave",e=>this.onCellLeave(e)),t.addEventListener("click",e=>this.onCellClick(e)),this.boardEl.appendChild(t)}this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";for(const s of e){const e=this.boardEl.children[s.position],a=document.createElement("div");a.classList.add("character",s.character.type);const i=document.createElement("div");i.classList.add("health-level");const n=document.createElement("div");n.classList.add("health-level-indicator",`health-level-indicator-${t=s.character.health,t<15?"critical":t<50?"normal":"high"}`),n.style.width=`${s.character.health}%`,i.appendChild(n),a.appendChild(i),e.appendChild(a)}var t}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach(e=>e.call(null,t))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach(e=>e.call(null,t))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach(e=>e.call(null,t))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach(e=>e.call(null))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach(e=>e.call(null))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach(e=>e.call(null))}static showError(e){alert(e)}static showMessage(e){alert(e)}selectCell(e,t="yellow"){this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){const t=this.cells[e];console.log(t),t.classList.remove(...Array.from(t.classList).filter(e=>e.startsWith("selected")))}showCellTooltip(e,t){this.cells[t].title=e}hideCellTooltip(e){this.cells[e].title=""}showDamage(e,t){return new Promise(s=>{const a=this.cells[e],i=document.createElement("span");i.textContent=t,i.classList.add("damage"),a.appendChild(i),i.addEventListener("animationend",()=>{a.removeChild(i),s()})})}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}class l{constructor(e,t="generic"){this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=t}levelUp(){this.level+=1,this.attack=Math.round(Math.max(this.attack,this.attack*(1.8-(100-this.health)/100))),this.defence=Math.round(Math.max(this.defence,this.defence*(1.8-(100-this.health)/100))),this.health=10*this.level+80,this.health>100&&(this.health=100)}}class r{constructor(e,t){if(!(e instanceof l))throw new Error("character must be instance of Character or its children");if("number"!=typeof t)throw new Error("position must be a number");this.character=e,this.position=t}}function o(e,t){let s=Math.floor(Math.random()*e.length),a=Math.floor(Math.random()*t+1);const[n,l]=function(e){let t=[],s=[];for(let s=0;s<e*e;s+=e)t.push(s);for(let s=1;s<e*e;s+=e)t.push(s);for(let t=e-1;t<e*e;t+=e)s.push(t);for(let t=e-2;t<e*e;t+=e)s.push(t);return[t,s]}(8),o=new e[s](1);if(a>1)for(i=0;i<a-1;i++)o.levelUp();let c=[];c="Bowman"===o.type||"Magician"===o.type||"Swordsman"===o.type?n:l;let h=c[Math.floor(Math.random()*c.length)];return new r(o,h)}function c(e,t,s){const a=[];for(let i=0;i<s;i++){const s=o(e,t);a.push(s)}return a}class h{constructor(e){this.boardSize=e,this.boardIndexes=this.makeIndexes(),this.boardArray=this.makeArray()}makeIndexes(){const e=[];for(let t=0;t<this.boardSize**2;t++)e.push(t);return e}makeArray(){let e=[];for(let t=0;t<this.boardIndexes.length;t+=this.boardSize)e.push(this.boardIndexes.slice(t,t+this.boardSize));return e}calculateArea(e,t){const s=[];let a=0;0!=t&&(a=this.boardArray.findIndex(e=>e.find(e=>e===t)));const i=this.boardArray[a].findIndex(e=>e===t);for(let t=a-e;t<=a+e;t++)if(t>=0&&t<this.boardSize)for(let a=i-e;a<=i+e;a++)a>=0&&a<this.boardSize&&s.push(this.boardArray[t][a]);return s.splice(s.indexOf(t),1),s}}class d extends l{constructor(e){super(e,"Bowman"),this.attack=25,this.defence=25,this.health=100,this.distanceAttack=2,this.distanceMove=2}}class u extends l{constructor(e){super(e,"Daemon"),this.attack=10,this.defence=40,this.health=100,this.distanceAttack=4,this.distanceMove=1}}class m extends l{constructor(e){super(e,"Swordsman"),this.attack=40,this.defence=10,this.health=100,this.distanceAttack=1,this.distanceMove=4}}class f extends l{constructor(e){super(e,"Undead"),this.attack=25,this.defence=25,this.health=100,this.distanceAttack=1,this.distanceMove=4}}class p extends l{constructor(e){super(e,"Vampire"),this.attack=40,this.defence=10,this.health=100,this.distanceAttack=2,this.distanceMove=2}}const v=new n;v.bindToDOM(document.querySelector("#game-container")),new class{constructor(e,t){this.gamePlay=e,this.board=new h,this.stateService=t,this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this),this.onCellClick=this.onCellClick.bind(this),this.playerChars=[],this.enemyChars=[],this.allChars=[]}startNewGame(){return this.playerChars=c([m,d],1,2),this.enemyChars=c([u,f,p],1,2),this.allChars=this.playerChars.concat(this.enemyChars),this.allChars}init(){this.gamePlay.drawUi("prairie"),this.addListeners(),this.gamePlay.redrawPositions(this.startNewGame())}addListeners(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(e){const t=event.target,s=t&&t.classList.contains("Bowman")||t.classList.contains("Swordsman")||t.classList.contains("Magician"),a=t.classList.contains("Undead")||t.classList.contains("Zombie")||t.classList.contains("Daemon");if(console.log(a),a&&n.showError("This is an enemy character!"),this.gamePlay.boardEl.querySelector(".selected-yellow")){const t=this.gamePlay.boardEl.querySelector(".selected-yellow"),a=this.gamePlay.cells.indexOf(t);this.gamePlay.deselectCell(a),s&&this.gamePlay.selectCell(e)}else s&&this.gamePlay.selectCell(e)}onCellEnter(e){if(event.target.querySelector(".character")){const t=this.allChars.filter(t=>t.position===e)[0].character,s=`üéñÔ∏è ${t.level} ‚öî ${t.attack} üõ°Ô∏è ${t.defence} ‚ô•Ô∏è ${t.health}`;this.gamePlay.showCellTooltip(s,e)}}onCellLeave(e){this.gamePlay.hideCellTooltip(e)}}(v,new class{constructor(e){this.storage=e}save(e){this.storage.setItem("state",JSON.stringify(e))}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}(localStorage)).init()}]);